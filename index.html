<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zozzetta - Gioco di Carte Napoletane</title>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a4d3a 0%, #2d5a47 100%);
            height: 100vh;
            overflow: hidden;
            margin: 0;
            padding: 0;
            padding-top: 7vh; /* Spazio per la barra di navigazione */
        }

        .game-table {
            width: 100%;
            height: 93vh; /* 93% dell'altezza dello schermo */
            background: url('public/background/classic.jpg') center/cover no-repeat;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            box-sizing: border-box;
        }

        .opponent-area {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            height: 140px; /* Altezza fissa */
            width: 70%; /* 70% della larghezza dello schermo */
            align-items: center;
            justify-content: center;
        }

        .player-area {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            height: 140px; /* Altezza fissa */
            width: 70%; /* 70% della larghezza dello schermo */
            align-items: center;
            justify-content: center;
        }

        .card {
            width: 50px;
            height: 75px;
            border-radius: 6px;
            border: 2px solid #2c3e50;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 22px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
        }

        .card:active {
            transform: translateY(-5px);
        }

        /* Carte del giocatore (napolitane) */
        .player-card {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        /* Carte dell'avversario (retro) */
        .opponent-card {
            background: 
                linear-gradient(45deg, transparent 25%, rgba(255,255,255,0.1) 25%, rgba(255,255,255,0.1) 50%, transparent 50%, transparent 75%, rgba(255,255,255,0.1) 75%),
                linear-gradient(145deg, #dc3545, #c82333);
            background-size: 8px 8px, 100% 100%;
            color: white;
            border: 2px solid #a71e2a;
        }

        .opponent-card .card-back {
            font-size: 22px;
        }

        .table-center {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
        }

        .navbar-title {
            color: white;
            font-size: 20px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            letter-spacing: 1px;
        }

        .center-cards {
            display: flex;
            gap: 10px;
            flex-wrap: nowrap;
            justify-content: center;
            overflow-x: auto;
            padding: 5px;
        }

        .cards-container {
            display: flex;
            gap: 10px;
            flex-wrap: nowrap;
            justify-content: center;
            overflow-x: auto;
            padding: 5px;
        }

        .deck-container {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 100;
        }

        .deck-card {
            position: relative;
            width: 50px;
            height: 75px;
            border-radius: 6px;
            border: 2px solid #a71e2a;
            background: 
                linear-gradient(45deg, transparent 25%, rgba(255,255,255,0.1) 25%, rgba(255,255,255,0.1) 50%, transparent 50%, transparent 75%, rgba(255,255,255,0.1) 75%),
                linear-gradient(145deg, #dc3545, #c82333);
            background-size: 8px 8px, 100% 100%;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .deck-back {
            font-size: 30px;
        }

        .deck-count {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 24px;
            font-weight: bold;
            z-index: 10;
            white-space: nowrap;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        .play-button {
            position: fixed;
            bottom: 180px;
            left: 50%;
            transform: translateX(-50%);
            width: 140px;
            height: 50px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            cursor: pointer;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 200;
            font-size: 16px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        .play-triangle {
            width: 0;
            height: 0;
            border-left: 30px solid white;
            border-top: 20px solid transparent;
            border-bottom: 20px solid transparent;
            margin-left: 5px; /* Sposta leggermente il triangolo per centrarlo */
        }

        .play-button:hover {
            transform: translateX(-50%) translateY(-3px);
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }

        .play-button:active {
            transform: translateX(-50%) translateY(-1px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .play-button:disabled {
            background: #6c757d;
            border-color: #495057;
            cursor: not-allowed;
            transform: translateX(-50%);
            box-shadow: none;
        }

        .turn-indicator {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%) rotate(90deg);
            color: white;
            font-weight: bold;
            font-size: 18px;
            z-index: 100;
            white-space: nowrap;
        }

        .player-captured {
            position: absolute;
            right: 15px;
        }

        .captured-deck {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        .captured-card {
            position: relative;
            width: 50px;
            height: 75px;
            border-radius: 6px;
            border: 2px solid #a71e2a;
            background: 
                linear-gradient(45deg, transparent 25%, rgba(255,255,255,0.1) 25%, rgba(255,255,255,0.1) 50%, transparent 50%, transparent 75%, rgba(255,255,255,0.1) 75%),
                linear-gradient(145deg, #dc3545, #c82333);
            background-size: 8px 8px, 100% 100%;
            color: white;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            font-size: 18px;
        }

        .captured-count {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 24px;
            font-weight: bold;
            z-index: 10;
            white-space: nowrap;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            line-height: 1;
        }
        
        .bot-captured {
            position: absolute;
            right: 15px;
        }

        .area-label {
            position: absolute;
            top: -10px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            color: #2c3e50;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            border: 2px solid #2c3e50;
        }

        .opponent-area .area-label {
            background: rgba(220, 53, 69, 0.9);
            color: white;
            border-color: #a71e2a;
        }

        .player-area .area-label {
            background: rgba(40, 167, 69, 0.9);
            color: white;
            border-color: #1e7e34;
        }

        /* Barra di navigazione superiore */
        .top-navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 7vh; /* 7% dell'altezza dello schermo */
            background: linear-gradient(135deg, #8B4513 0%, #CD853F 50%, #D2691E 100%);
            border-bottom: 3px solid #654321;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .home-button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 8px;
            border-radius: 8px;
            width: 38px;
            height: 38px;
        }

        .home-button:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .restart-button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 8px;
            border-radius: 8px;
            width: 38px;
            height: 38px;
        }

        .restart-button:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .home-button:active {
            transform: translateY(0);
        }

        .restart-button:active {
            transform: translateY(0);
        }

        .home-icon {
            width: 18px;
            height: 18px;
            color: #4a2f1a;
            transition: all 0.3s ease;
            transform: scaleX(-1); /* Inverte orizzontalmente l'icona */
        }

        .restart-icon {
            width: 18px;
            height: 18px;
            color: #4a2f1a;
            transition: all 0.3s ease;
        }

        .home-button:hover .home-icon {
            color: #2f1b14;
            transform: scaleX(-1) scale(1.1); /* Mantiene l'inversione e aggiunge lo scale */
        }

        .restart-button:hover .restart-icon {
            color: #2f1b14;
            transform: scale(1.1);
        }

        .burger-button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 8px;
            border-radius: 8px;
            width: 38px;
            height: 38px;
        }

        .burger-button:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .burger-button:active {
            transform: translateY(0);
        }

        .burger-icon {
            width: 18px;
            height: 18px;
            color: #4a2f1a;
            transition: all 0.3s ease;
        }

        .burger-button:hover .burger-icon {
            color: #2f1b14;
            transform: scale(1.1);
        }

        /* Responsive per mobile */
        @media (max-width: 768px) {
            body {
                padding-top: 7vh; /* Mantiene lo stesso spazio per la barra */
            }
            
            .top-navbar {
                padding: 0 15px;
            }
            
            .home-icon, .burger-icon {
                width: 20px;
                height: 20px;
            }
            
            .navbar-title {
                font-size: 18px;
            }
            
            .turn-indicator {
                right: 3px;
                font-size: 16px;
            }
            
            .deck-container {
                left: 15px;
            }
            
            .deck-count {
                font-size: 20px;
            }
            
            .captured-count {
                font-size: 20px;
            }
            
            .play-button {
                width: 120px;
                height: 45px;
                font-size: 14px;
                bottom: 160px;
            }
            
            .play-triangle {
                border-left: 25px solid white;
                border-top: 15px solid transparent;
                border-bottom: 15px solid transparent;
            }
        }

        @media (max-width: 480px) {
            body {
                padding-top: 7vh; /* Mantiene lo stesso spazio per la barra */
            }
            
            .top-navbar {
                padding: 0 10px;
            }
            
            .home-icon, .burger-icon {
                width: 18px;
                height: 18px;
            }
            
            .navbar-title {
                font-size: 16px;
            }
            
            .turn-indicator {
                right: 2px;
                font-size: 14px;
            }
            
            .deck-container {
                left: 10px;
            }
            
            .deck-count {
                font-size: 18px;
            }
            
            .captured-count {
                font-size: 18px;
            }
            
            .play-button {
                width: 100px;
                height: 40px;
                font-size: 12px;
                bottom: 140px;
            }
            
            .play-triangle {
                border-left: 22px solid white;
                border-top: 14px solid transparent;
                border-bottom: 14px solid transparent;
            }
        }

        .opponent-area:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }

        .player-area:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }

        /* Responsive design per schermi più piccoli */
        @media (max-width: 768px) {
            .opponent-area, .player-area {
                padding: 12px;
                height: 120px; /* Altezza fissa per mobile */
                gap: 8px;
                width: 90%; /* 90% della larghezza dello schermo */
                max-width: 400px; /* Limite massimo per schermi molto grandi */
                justify-content: space-between; /* Mazzetto a sinistra, carte al centro */
            }
            
            .deck-back {
                font-size: 25px;
            }
            
            .area-label {
                font-size: 12px;
                padding: 4px 12px;
            }

            /* Stile per il mazzetto a sinistra */
            .deck-container {
                order: -1; /* Mette il mazzetto a sinistra */
                margin-right: 15px;
                flex-shrink: 0; /* Non si riduce */
            }

            /* Stile per le carte al centro */
            .cards-container {
                display: flex;
                gap: 10px;
                justify-content: center;
                flex: 1;
            }
        }

        /* Per schermi molto piccoli */
        @media (max-width: 480px) {
            .opponent-area, .player-area {
                width: 90%; /* Mantiene il 90% anche su schermi piccoli */
                padding: 10px;
                gap: 6px;
                height: 110px; /* Altezza fissa per mobile piccolo */
            }
            
            .deck-back {
                font-size: 22px;
            }
        }


    </style>
</head>
<body>
    <!-- Barra di navigazione superiore -->
    <nav class="top-navbar">
        <div style="display: flex; gap: 10px;">
            <button class="home-button" onclick="goHome()">
                <i data-lucide="log-out" class="home-icon"></i>
            </button>
            <button class="restart-button" onclick="restartGame()">
                <i data-lucide="refresh-cw" class="restart-icon"></i>
            </button>
        </div>
        <div class="navbar-title">ZOZZETTA</div>
        <button class="burger-button" onclick="toggleMenu()">
            <i data-lucide="menu" class="burger-icon"></i>
        </button>
    </nav>

    <!-- Indicatore del turno -->

    <!-- Pulsante Distribuisci sopra il container del giocatore -->
    <button class="play-button" id="playButton" onclick="startGame()">
        DISTRIBUISCI
    </button>

    <div class="game-table">
        <!-- Indicatore del turno -->
        <div class="turn-indicator" id="turnIndicator">Turno 1</div>

        <!-- Mazzo delle carte -->
        <div class="deck-container">
            <div class="deck-card">
                <div class="deck-back"></div>
                <div class="deck-count" id="deckCount">40</div>
            </div>
        </div>

        <!-- Area avversario (carte retro) -->
        <div class="opponent-area">
            <div class="area-label">BOT</div>
            <div class="cards-container">
                <!-- Le carte del bot appariranno qui -->
            </div>
            <!-- Contatore carte mangiate dal bot -->
            <div class="bot-captured">
                <div class="captured-deck">
                    <div class="captured-card"></div>
                    <div class="captured-count" id="botCapturedCount">0</div>
                </div>
            </div>
        </div>

        <!-- Centro tavolo -->
        <div class="table-center">
            <div class="center-cards">
                <!-- Le carte giocate appariranno qui -->
            </div>
        </div>

        <!-- Area giocatore (carte napoletane) -->
        <div class="player-area">
            <div class="area-label">GUEST</div>
            <div class="cards-container">
                <!-- Le carte del giocatore appariranno qui -->
            </div>
            <!-- Contatore carte mangiate dal giocatore -->
            <div class="player-captured">
                <div class="captured-deck">
                    <div class="captured-card"></div>
                    <div class="captured-count" id="playerCapturedCount">0</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let isPlayerTurn = true; // Controlla se è il turno del giocatore
        
        // Mazzo completo di 40 carte napoletane (uniche)
        const fullDeck = [
            // Spade (1-10)
            { image: 'public/cards/spade1.png', name: 'Asso di Spade', value: 1, suit: 'spade' },
            { image: 'public/cards/spade2.png', name: '2 di Spade', value: 2, suit: 'spade' },
            { image: 'public/cards/spade3.png', name: '3 di Spade', value: 3, suit: 'spade' },
            { image: 'public/cards/spade4.png', name: '4 di Spade', value: 4, suit: 'spade' },
            { image: 'public/cards/spade5.png', name: '5 di Spade', value: 5, suit: 'spade' },
            { image: 'public/cards/spade6.png', name: '6 di Spade', value: 6, suit: 'spade' },
            { image: 'public/cards/spade7.png', name: '7 di Spade', value: 7, suit: 'spade' },
            { image: 'public/cards/spade8.png', name: 'Donna di Spade', value: 8, suit: 'spade' },
            { image: 'public/cards/spade9.png', name: 'Cavallo di Spade', value: 9, suit: 'spade' },
            { image: 'public/cards/spade10.png', name: 'Re di Spade', value: 10, suit: 'spade' },
            
            // Coppe (1-10)
            { image: 'public/cards/coppe1.png', name: 'Asso di Coppe', value: 1, suit: 'coppe' },
            { image: 'public/cards/coppe2.png', name: '2 di Coppe', value: 2, suit: 'coppe' },
            { image: 'public/cards/coppe3.png', name: '3 di Coppe', value: 3, suit: 'coppe' },
            { image: 'public/cards/coppe4.png', name: '4 di Coppe', value: 4, suit: 'coppe' },
            { image: 'public/cards/coppe5.png', name: '5 di Coppe', value: 5, suit: 'coppe' },
            { image: 'public/cards/coppe6.png', name: '6 di Coppe', value: 6, suit: 'coppe' },
            { image: 'public/cards/coppe7.png', name: '7 di Coppe', value: 7, suit: 'coppe' },
            { image: 'public/cards/coppe8.png', name: 'Donna di Coppe', value: 8, suit: 'coppe' },
            { image: 'public/cards/coppe9.png', name: 'Cavallo di Coppe', value: 9, suit: 'coppe' },
            { image: 'public/cards/coppe10.png', name: 'Re di Coppe', value: 10, suit: 'coppe' },
            
            // Denari (1-10)
            { image: 'public/cards/denara1.png', name: 'Asso di Denari', value: 1, suit: 'denari' },
            { image: 'public/cards/denara2.png', name: '2 di Denari', value: 2, suit: 'denari' },
            { image: 'public/cards/denara3.png', name: '3 di Denari', value: 3, suit: 'denari' },
            { image: 'public/cards/denara4.png', name: '4 di Denari', value: 4, suit: 'denari' },
            { image: 'public/cards/denara5.png', name: '5 di Denari', value: 5, suit: 'denari' },
            { image: 'public/cards/denara6.png', name: '6 di Denari', value: 6, suit: 'denari' },
            { image: 'public/cards/denara7.png', name: '7 di Denari', value: 7, suit: 'denari' },
            { image: 'public/cards/denara8.png', name: 'Donna di Denari', value: 8, suit: 'denari' },
            { image: 'public/cards/denara9.png', name: 'Cavallo di Denari', value: 9, suit: 'denari' },
            { image: 'public/cards/denara10.png', name: 'Re di Denari', value: 10, suit: 'denari' },
            
            // Bastoni (1-10)
            { image: 'public/cards/bastoni1.png', name: 'Asso di Bastoni', value: 1, suit: 'bastoni' },
            { image: 'public/cards/bastoni2.png', name: '2 di Bastoni', value: 2, suit: 'bastoni' },
            { image: 'public/cards/bastoni3.png', name: '3 di Bastoni', value: 3, suit: 'bastoni' },
            { image: 'public/cards/bastoni4.png', name: '4 di Bastoni', value: 4, suit: 'bastoni' },
            { image: 'public/cards/bastoni5.png', name: '5 di Bastoni', value: 5, suit: 'bastoni' },
            { image: 'public/cards/bastoni6.png', name: '6 di Bastoni', value: 6, suit: 'bastoni' },
            { image: 'public/cards/bastoni7.png', name: '7 di Bastoni', value: 7, suit: 'bastoni' },
            { image: 'public/cards/bastoni8.png', name: 'Donna di Bastoni', value: 8, suit: 'bastoni' },
            { image: 'public/cards/bastoni9.png', name: 'Cavallo di Bastoni', value: 9, suit: 'bastoni' },
            { image: 'public/cards/bastoni10.png', name: 'Re di Bastoni', value: 10, suit: 'bastoni' }
        ];
        
        // Array per tracciare le carte usate
        let usedCards = [];
        let playerHand = [];
        let botHand = [];
        let tableCards = [];
        let gameStarted = false;
        let currentTurn = 1;
        let isDistributing = false;
        let playerCapturedCards = 0;
        let botCapturedCards = 0;
        let isPlayerTurnReallyFinished = true; // Inizia come true per permettere al giocatore di giocare
        let isBotTurnReallyFinished = true; // Inizia come true per permettere al giocatore di giocare

        // Funzione per mescolare il mazzo
        function shuffleDeck(deck) {
            const shuffled = [...deck];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Funzione per iniziare il gioco
        function startGame() {
            if (gameStarted) return;
            
            gameStarted = true;
            isDistributing = true;
            isPlayerTurn = true;
            isPlayerTurnReallyFinished = true;
            isBotTurnReallyFinished = true;
            const playButton = document.getElementById('playButton');
            playButton.disabled = true;
            
            // Mescola il mazzo
            const shuffledDeck = shuffleDeck(fullDeck);
            
            // Distribuisci le carte sequenzialmente
            distributeCardsSequentially(shuffledDeck);
        }

        // Funzione per distribuire le carte una alla volta
        function distributeCardsSequentially(deck) {
            let cardIndex = 0;
            let distributionStep = 0;
            
            const distributeNext = () => {
                if (distributionStep < 6) {
                    // Distribuisci una carta al giocatore o al bot alternativamente
                    if (distributionStep % 2 === 0) {
                        // Carta al giocatore
                        playerHand.push(deck[cardIndex]);
                        usedCards.push(deck[cardIndex]);
                        updatePlayerCards();
                    } else {
                        // Carta al bot
                        botHand.push(deck[cardIndex]);
                        usedCards.push(deck[cardIndex]);
                        updateBotCards();
                    }
                    
                    cardIndex++;
                    distributionStep++;
                    updateDeckCount();
                    
                    // Continua la distribuzione dopo 500ms
                    setTimeout(distributeNext, 500);
                } else if (distributionStep < 10) {
                    // Distribuisci le 4 carte al tavolo
                    tableCards.push(deck[cardIndex]);
                    usedCards.push(deck[cardIndex]);
                    cardIndex++;
                    distributionStep++;
                    updateTableCards();
                    updateDeckCount();
                    
                    // Continua la distribuzione dopo 300ms
                    setTimeout(distributeNext, 300);
                } else {
                    // Distribuzione completata
                    isDistributing = false;
                    isPlayerTurn = true;
                    isPlayerTurnReallyFinished = true;
                    isBotTurnReallyFinished = true;
                    const playButton = document.getElementById('playButton');
                    playButton.style.display = 'none';
                    
                    const turnIndicator = document.getElementById('turnIndicator');
                    turnIndicator.textContent = `Turno ${currentTurn}`;
                    
                    console.log('Distribuzione completata!');
                    console.log('Carte rimanenti nel mazzo:', 40 - usedCards.length);
                    console.log('Carte del giocatore:', playerHand.length);
                    console.log('Carte del bot:', botHand.length);
                    console.log('Carte sul tavolo:', tableCards.length);
                }
            };
            
            distributeNext();
        }

        // Funzione per aggiornare le carte del giocatore
        function updatePlayerCards() {
            const playerArea = document.querySelector('.player-area');
            const cardsContainer = playerArea.querySelector('.cards-container');
            cardsContainer.innerHTML = '';
            
            playerHand.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'card player-card';
                cardElement.style.backgroundImage = `url('${card.image}')`;
                cardElement.onclick = () => playCard(cardElement);
                cardElement.dataset.cardIndex = index;
                cardsContainer.appendChild(cardElement);
            });
        }

        // Funzione per aggiornare le carte del bot
        function updateBotCards() {
            const opponentArea = document.querySelector('.opponent-area');
            const cardsContainer = opponentArea.querySelector('.cards-container');
            cardsContainer.innerHTML = '';
            
            botHand.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'card opponent-card';
                cardElement.innerHTML = '<div class="card-back"></div>';
                cardsContainer.appendChild(cardElement);
            });
        }

        // Funzione per aggiornare le carte sul tavolo
        function updateTableCards() {
            const centerCards = document.querySelector('.center-cards');
            centerCards.innerHTML = '';
            
            tableCards.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'card center-card';
                cardElement.style.backgroundImage = `url('${card.image}')`;
                cardElement.onclick = () => takeCardFromTable(cardElement);
                cardElement.dataset.cardIndex = index;
                centerCards.appendChild(cardElement);
            });
        }

        // Funzione per aggiornare il contatore del mazzo
        function updateDeckCount() {
            const remainingCards = fullDeck.length - usedCards.length;
            const deckCountElement = document.getElementById('deckCount');
            deckCountElement.textContent = remainingCards;
        }

        // Funzione per trovare le carte corrispondenti sul tavolo
        function findMatchingCards(playedCard, tableCards) {
            const matchingCards = [];
            
            tableCards.forEach(tableCard => {
                // Controlla se il valore è uguale (numero o figura)
                if (playedCard.value === tableCard.value) {
                    matchingCards.push(tableCard);
                }
            });
            
            return matchingCards;
        }

        // Funzione per evidenziare le carte corrispondenti
        function highlightMatchingCards(matchingCards) {
            const centerCards = document.querySelectorAll('.center-card');
            centerCards.forEach(cardElement => {
                const cardIndex = parseInt(cardElement.dataset.cardIndex);
                const card = tableCards[cardIndex];
                
                if (matchingCards.includes(card)) {
                    cardElement.style.transform = 'scale(1.2)';
                    cardElement.style.boxShadow = '0 0 20px #ffd700';
                    cardElement.style.border = '3px solid #ffd700';
                }
            });
        }

        // Funzione per aggiornare il contatore delle carte mangiate
        function updateCapturedCount() {
            const playerCountElement = document.getElementById('playerCapturedCount');
            playerCountElement.textContent = playerCapturedCards;
        }
        
        // Funzione per aggiornare il contatore delle carte catturate dal bot
        function updateBotCapturedCount() {
            const botCapturedCountElement = document.getElementById('botCapturedCount');
            if (botCapturedCountElement) {
                botCapturedCountElement.textContent = botCapturedCards;
            }
        }

        function playCard(cardElement) {
            console.log('Carta cliccata:', {
                isPlayerTurn: isPlayerTurn,
                isDistributing: isDistributing,
                hasPlayerCardClass: cardElement.classList.contains('player-card'),
                cardElement: cardElement
            });
            
            // Blocca il gioco durante la distribuzione
            if (isDistributing) {
                console.log('Distribuzione in corso, attendere...');
                return;
            }
            
            // Verifica se è il turno del giocatore, se la carta è del giocatore e se il bot ha finito il suo turno
            if (isPlayerTurn && cardElement.classList.contains('player-card') && isBotTurnReallyFinished) {
                const cardIndex = parseInt(cardElement.dataset.cardIndex);
                const playedCard = playerHand[cardIndex];
                
                // Controlla se ci sono corrispondenze sul tavolo
                const matchingCards = findMatchingCards(playedCard, tableCards);
                
                if (matchingCards.length > 0) {
                    // Prima aggiungi la carta al tavolo per l'effetto visivo
                    tableCards.push(playedCard);
                    updateTableCards();
                    
                    // Aspetta un po' per mostrare la carta sul tavolo
                    setTimeout(() => {
                        // Evidenzia le carte corrispondenti (inclusa quella del giocatore)
                        highlightMatchingCards([playedCard, ...matchingCards]);
                        
                        // Aspetta un po' per l'effetto di evidenziazione
                        setTimeout(() => {
                            // Rimuovi le carte corrispondenti dal tavolo
                            matchingCards.forEach(matchingCard => {
                                const index = tableCards.indexOf(matchingCard);
                                if (index > -1) {
                                    tableCards.splice(index, 1);
                                }
                            });
                            
                            // Rimuovi anche la carta del giocatore dal tavolo
                            const playerCardIndex = tableCards.indexOf(playedCard);
                            if (playerCardIndex > -1) {
                                tableCards.splice(playerCardIndex, 1);
                            }
                            
                            // Aggiorna il contatore delle carte mangiate
                            playerCapturedCards += matchingCards.length + 1; // +1 per la carta del giocatore
                            updateCapturedCount();
                            
                            // Aggiorna la visualizzazione
                            updateTableCards();
                            
                            console.log('Carte corrispondenti trovate! Carte rimosse:', matchingCards.map(c => c.name));
                        }, 1000);
                    }, 500);
                    
                    // Rimuovi la carta dalla mano del giocatore
                    playerHand.splice(cardIndex, 1);
                } else {
                    // Nessuna corrispondenza, aggiungi la carta al tavolo
                    tableCards.push(playedCard);
                    playerHand.splice(cardIndex, 1);
                }
                
                // Aggiorna le carte visibili
                updatePlayerCards();
                updateTableCards();
                updateDeckCount();
                
                // Controlla se il giocatore ha finito le carte
                console.log('Giocatore ha giocato carta. Carte rimanenti:', playerHand.length);
                if (playerHand.length === 0) {
                    console.log('Giocatore ha finito le carte!');
                    // Il giocatore ha finito, controlla se entrambi hanno finito
                    checkIfBothPlayersFinished();
                } else {
                    console.log('Giocatore ha ancora carte, bot gioca');
                    // Disabilita il turno del giocatore
                    isPlayerTurn = false;
                    isPlayerTurnReallyFinished = false;
                    isBotTurnReallyFinished = false; // Reset del flag del bot
                    
                    // Se ci sono corrispondenze, aspetta che finisca l'animazione
                    if (matchingCards.length > 0) {
                        // Il bot gioca dopo che finisce l'animazione (500ms + 1000ms + 500ms)
                        setTimeout(() => {
                            isPlayerTurnReallyFinished = true;
                            botPlayCard();
                        }, 2000);
                    } else {
                        // Nessuna corrispondenza, il bot gioca subito
                        setTimeout(() => {
                            isPlayerTurnReallyFinished = true;
                            botPlayCard();
                        }, 1000);
                    }
                }
            }
            
            // Aggiungi effetto visivo quando si clicca una carta
            cardElement.style.transform = 'translateY(-15px) scale(1.05)';
            cardElement.style.boxShadow = '0 12px 24px rgba(0, 0, 0, 0.5)';
            
            // Rimuovi l'effetto dopo un po'
            setTimeout(() => {
                cardElement.style.transform = 'translateY(-10px) scale(1)';
                cardElement.style.boxShadow = '0 8px 16px rgba(0, 0, 0, 0.4)';
            }, 200);
        }


        function takeCardFromTable(cardElement) {
            // Aggiungi effetto visivo
            cardElement.style.transform = 'translateY(-5px) scale(1.1)';
            cardElement.style.boxShadow = '0 8px 16px rgba(0, 0, 0, 0.6)';
            
            // Per ora, le carte del tavolo non vengono rimosse quando cliccate
            // Potremmo aggiungere logica per "prenderle" in futuro
            setTimeout(() => {
                cardElement.style.transform = 'translateY(0) scale(1)';
                cardElement.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.3)';
                console.log('Carta del tavolo cliccata (non rimossa)');
            }, 200);
        }

        function botPlayCard() {
            // Controlla se il turno del giocatore è veramente finito
            if (!isPlayerTurnReallyFinished) {
                console.log('Bot non può giocare: turno giocatore non finito');
                return;
            }
            
            console.log('Bot gioca carta. Carte rimanenti:', botHand.length);
            if (botHand.length > 0) {
                // Il bot gioca la prima carta disponibile
                const playedCard = botHand[0];
                botHand.shift(); // Rimuovi la carta dalla mano del bot
                
                // Aggiorna le carte del bot (rimuove la carta dalla visualizzazione)
                updateBotCards();
                
                // Controlla se ci sono corrispondenze sul tavolo
                const matchingCards = findMatchingCards(playedCard, tableCards);
                
                if (matchingCards.length > 0) {
                    // Prima aggiungi la carta del bot al tavolo per l'effetto visivo
                    tableCards.push(playedCard);
                    updateTableCards();
                    
                    // Aspetta un po' per mostrare la carta sul tavolo
                    setTimeout(() => {
                        // Evidenzia le carte corrispondenti (inclusa quella del bot)
                        highlightMatchingCards([playedCard, ...matchingCards]);
                        
                        // Aspetta un po' per l'effetto di evidenziazione
                        setTimeout(() => {
                            // Rimuovi le carte corrispondenti dal tavolo
                            matchingCards.forEach(matchingCard => {
                                const index = tableCards.indexOf(matchingCard);
                                if (index > -1) {
                                    tableCards.splice(index, 1);
                                }
                            });
                            
                            // Rimuovi anche la carta del bot dal tavolo
                            const botCardIndex = tableCards.indexOf(playedCard);
                            if (botCardIndex > -1) {
                                tableCards.splice(botCardIndex, 1);
                            }
                            
                            // Aggiorna il tavolo
                            updateTableCards();
                            
                            // Incrementa il contatore delle carte catturate dal bot
                            botCapturedCards += matchingCards.length + 1; // +1 per la carta giocata
                            updateBotCapturedCount();
                            
                            console.log('Bot ha trovato corrispondenze! Carte rimosse:', matchingCards.map(c => c.name));
                            console.log('Carte catturate dal bot:', botCapturedCards);
                            
                            // Il turno del bot è finito
                            isBotTurnReallyFinished = true;
                            
                            // Controlla se entrambi i giocatori hanno finito
                            checkIfBothPlayersFinished();
                        }, 1000);
                    }, 500);
                } else {
                    // Nessuna corrispondenza, aggiungi la carta al tavolo
                    tableCards.push(playedCard);
                    updateTableCards();
                    updateDeckCount();
                    
                    // Il turno del bot è finito
                    isBotTurnReallyFinished = true;
                    
                    // Controlla se entrambi i giocatori hanno finito
                    checkIfBothPlayersFinished();
                }
                
                console.log('Bot ha giocato:', playedCard.name);
                console.log('Bot carte rimanenti dopo:', botHand.length);
            } else {
                console.log('Bot non ha più carte');
                // Se il bot non ha più carte, controlla se entrambi hanno finito
                checkIfBothPlayersFinished();
            }
        }

        // Funzione per controllare se entrambi i giocatori hanno finito le carte
        function checkIfBothPlayersFinished() {
            const remainingCards = fullDeck.length - usedCards.length;
            console.log('Controllo se entrambi hanno finito:', {
                playerHand: playerHand.length,
                botHand: botHand.length,
                remainingCards: remainingCards
            });
            
            if (playerHand.length === 0 && botHand.length === 0) {
                if (remainingCards >= 6) {
                    console.log('Entrambi hanno finito! Mostro il pulsante DISTRIBUISCI');
                    // Entrambi hanno finito le carte e ci sono abbastanza carte per distribuire, mostra il pulsante per il turno successivo
                    showDistributeButton();
                } else {
                    console.log('Entrambi hanno finito ma non ci sono abbastanza carte per distribuire. Gioco finito!');
                    // Entrambi hanno finito le carte ma non ci sono abbastanza carte per distribuire, il gioco è finito
                    showGameOver();
                }
            } else if (playerHand.length === 0 && botHand.length > 0) {
                console.log('Giocatore ha finito, bot deve giocare la sua ultima carta');
                // Il giocatore ha finito ma il bot ha ancora carte, fai giocare il bot
                isPlayerTurn = false;
                setTimeout(() => {
                    botPlayCard();
                }, 1000);
            } else {
                console.log('Uno dei due ha ancora carte, riabilito il turno del giocatore');
                // Riabilita il turno del giocatore
                isPlayerTurn = true;
                isPlayerTurnReallyFinished = true; // Reset del flag per il nuovo turno
                isBotTurnReallyFinished = true; // Reset del flag del bot
            }
        }

        // Funzione per mostrare il pulsante di distribuzione
        function showDistributeButton() {
            const playButton = document.getElementById('playButton');
            playButton.style.display = 'block';
            playButton.disabled = false;
            playButton.textContent = 'DISTRIBUISCI';
            playButton.onclick = distributeNextTurn;
            
            // Aggiorna l'indicatore del turno
            currentTurn++;
            const turnIndicator = document.getElementById('turnIndicator');
            turnIndicator.textContent = `Turno ${currentTurn}`;
        }

        // Funzione per mostrare la fine del gioco
        function showGameOver() {
            const playButton = document.getElementById('playButton');
            playButton.style.display = 'block';
            playButton.disabled = true;
            playButton.style.background = 'linear-gradient(135deg, #dc3545, #c82333)';
            playButton.textContent = 'GIOCO FINITO';
            playButton.onclick = null;
            
            // Aggiorna l'indicatore del turno
            const turnIndicator = document.getElementById('turnIndicator');
            turnIndicator.textContent = 'GIOCO FINITO';
            
            console.log('Gioco finito! Non ci sono abbastanza carte per distribuire.');
        }

        // Funzione per distribuire le carte del turno successivo
        function distributeNextTurn() {
            if (isDistributing) return;
            
            isDistributing = true;
            const playButton = document.getElementById('playButton');
            playButton.disabled = true;
            
            // Ottieni le carte rimanenti dal mazzo
            const remainingCards = fullDeck.filter(card => !usedCards.includes(card));
            const shuffledRemaining = shuffleDeck(remainingCards);
            
            // Distribuisci 3 carte a testa (senza carte a terra)
            distributeCardsForNextTurn(shuffledRemaining);
        }

        // Funzione per distribuire le carte del turno successivo
        function distributeCardsForNextTurn(deck) {
            let cardIndex = 0;
            let distributionStep = 0;
            
            const distributeNext = () => {
                if (distributionStep < 6) {
                    // Distribuisci una carta al giocatore o al bot alternativamente
                    if (distributionStep % 2 === 0) {
                        // Carta al giocatore
                        playerHand.push(deck[cardIndex]);
                        usedCards.push(deck[cardIndex]);
                        updatePlayerCards();
                    } else {
                        // Carta al bot
                        botHand.push(deck[cardIndex]);
                        usedCards.push(deck[cardIndex]);
                        updateBotCards();
                    }
                    
                    cardIndex++;
                    distributionStep++;
                    updateDeckCount();
                    
                    // Continua la distribuzione dopo 500ms
                    setTimeout(distributeNext, 500);
                } else {
                    // Distribuzione completata
                    isDistributing = false;
                    isPlayerTurn = true; // Abilita il turno del giocatore
                    isPlayerTurnReallyFinished = true; // Reset del flag per il nuovo turno
                    isBotTurnReallyFinished = true; // Reset del flag del bot
                    const playButton = document.getElementById('playButton');
                    playButton.style.display = 'none';
                    
                    // Aggiorna l'indicatore del turno
                    const turnIndicator = document.getElementById('turnIndicator');
                    turnIndicator.textContent = `Turno ${currentTurn}`;
                    
                    console.log(`Turno ${currentTurn} distribuito!`);
                    console.log('Carte rimanenti nel mazzo:', 40 - usedCards.length);
                    console.log('Carte del giocatore:', playerHand.length);
                    console.log('Carte del bot:', botHand.length);
                }
            };
            
            distributeNext();
        }


        // Funzione per uscire dal gioco
        function goHome() {
            // Ricarica la pagina per tornare allo stato iniziale
            location.reload();
        }

        function restartGame() {
            // Riavvia la partita ricaricando la pagina
            location.reload();
        }

        // Funzione per aprire/chiudere il menu
        function toggleMenu() {
            console.log('Menu burger cliccato');
            // Qui puoi aggiungere la logica per aprire/chiudere un menu
            alert('Menu - Funzionalità in arrivo!');
        }

        // Inizializza le icone Lucide
        function initializeLucideIcons() {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }

        // Inizializza il gioco al caricamento
        window.addEventListener('load', () => {
            // Inizializza le icone Lucide
            initializeLucideIcons();
            
            // Inizializza con mazzo vuoto e contatore a 40
            updateDeckCount();
            
            // Nascondi le aree delle carte inizialmente
            document.querySelector('.player-area .cards-container').innerHTML = '';
            document.querySelector('.opponent-area .cards-container').innerHTML = '';
            document.querySelector('.center-cards').innerHTML = '';
        });
    </script>
</body>
</html>
